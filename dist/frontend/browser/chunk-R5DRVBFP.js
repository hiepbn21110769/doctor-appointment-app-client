import{c as O,o as U}from"./chunk-PREI7CCJ.js";import{$ as d,$a as I,C as g,Ia as b,Nc as s,X as w,_a as h,aa as k,ab as j,ba as S,ca as l,ha as T,ia as y,jb as v,k as D,kb as x,lb as P,nc as C,p as f,q as m,qa as E,qc as M,wc as N,yc as R}from"./chunk-UHTXMJPS.js";var B=(()=>{class o{styleClass;style;strokeWidth="2";fill="none";animationDuration="2s";ariaLabel;static \u0275fac=function(t){return new(t||o)};static \u0275cmp=T({type:o,selectors:[["p-progressSpinner"]],hostAttrs:[1,"p-element"],inputs:{styleClass:"styleClass",style:"style",strokeWidth:"strokeWidth",fill:"fill",animationDuration:"animationDuration",ariaLabel:"ariaLabel"},decls:3,vars:11,consts:[["role","progressbar",1,"p-progress-spinner",3,"ngStyle","ngClass"],["viewBox","25 25 50 50",1,"p-progress-spinner-svg"],["cx","50","cy","50","r","20","stroke-miterlimit","10",1,"p-progress-spinner-circle"]],template:function(t,r){t&1&&(v(0,"div",0),E(),v(1,"svg",1),P(2,"circle",2),x()()),t&2&&(I("ngStyle",r.style)("ngClass",r.styleClass),h("aria-label",r.ariaLabel)("aria-busy",!0)("data-pc-name","progressspinner")("data-pc-section","root"),b(),j("animation-duration",r.animationDuration),h("data-pc-section","root"),b(),h("fill",r.fill)("stroke-width",r.strokeWidth))},dependencies:[C,M],styles:[`@layer primeng{.p-progress-spinner{position:relative;margin:0 auto;width:100px;height:100px;display:inline-block}.p-progress-spinner:before{content:"";display:block;padding-top:100%}.p-progress-spinner-svg{animation:p-progress-spinner-rotate 2s linear infinite;height:100%;transform-origin:center center;width:100%;position:absolute;inset:0;margin:auto}.p-progress-spinner-circle{stroke-dasharray:89,200;stroke-dashoffset:0;stroke:#d62d20;animation:p-progress-spinner-dash 1.5s ease-in-out infinite,p-progress-spinner-color 6s ease-in-out infinite;stroke-linecap:round}}@keyframes p-progress-spinner-rotate{to{transform:rotate(360deg)}}@keyframes p-progress-spinner-dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:89,200;stroke-dashoffset:-35px}to{stroke-dasharray:89,200;stroke-dashoffset:-124px}}@keyframes p-progress-spinner-color{to,0%{stroke:#d62d20}40%{stroke:#0057e7}66%{stroke:#008744}80%,90%{stroke:#ffa700}}
`],encapsulation:2,changeDetection:0})}return o})(),V=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=y({type:o});static \u0275inj=k({imports:[N]})}return o})();var $=new S("JWT_OPTIONS"),J=(()=>{class o{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let n=0,p,a,u=0;a=e.charAt(u++);~a&&(p=n%4?p*64+a:a,n++%4)?r+=String.fromCharCode(255&p>>(-2*n&6)):0)a=t.indexOf(a);return r}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let r=new Date(0);return r.setUTCSeconds(t.exp),r}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(r=>this._isTokenExpired(r,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let r=this.getTokenExpirationDate(e);return t=t||0,r===null?!1:!(r.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return o.\u0275fac=function(e){return new(e||o)(l($))},o.\u0275prov=d({token:o,factory:o.\u0275fac}),o})();var c=class extends Error{};c.prototype.name="InvalidTokenError";function W(o){return decodeURIComponent(atob(o).replace(/(.)/g,(i,e)=>{let t=e.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function G(o){let i=o.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return W(i)}catch{return atob(i)}}function H(o,i){if(typeof o!="string")throw new c("Invalid token specified: must be a string");i||(i={});let e=i.header===!0?0:1,t=o.split(".")[e];if(typeof t!="string")throw new c(`Invalid token specified: missing part #${e+1}`);let r;try{r=G(t)}catch(n){throw new c(`Invalid token specified: invalid base64 for part #${e+1} (${n.message})`)}try{return JSON.parse(r)}catch(n){throw new c(`Invalid token specified: invalid json for part #${e+1} (${n.message})`)}}var ae=(()=>{class o{constructor(e,t,r){this.jwtHelper=e,this.http=t,this.store=r,this.userDataSubject=new D(null),this.userData$=this.userDataSubject.asObservable()}isAuthenticated(){let e=localStorage.getItem("token");return this.jwtHelper.decodeToken(e)==null?f(!1):f(!this.jwtHelper.isTokenExpired(e))}hasPermission(e){let t=localStorage.getItem("token");if(t){let n=H(t)?.scope;if(e.includes(n))return!0}return!1}refreshToken(){return this.http.post(s+"/api/auth/refreshToken",{token:localStorage.getItem("token")}).pipe(w(e=>{localStorage.setItem("token",e.token),this.store.dispatch(U({refreshTokenResponse:e}))}),g(e=>(console.error("Error refreshing access token:",e),localStorage.removeItem("token"),m(e))))}logout(){return this.http.post(s+"/api/auth/logout",{token:localStorage.getItem("token")})}setUserData(e){this.userDataSubject.next(e)}getUserData(){return this.http.get(s+"/api/identity/myInfo")}onLogin(e){return this.http.post(s+"/api/auth/login",e)}onSignupPatient(e){return this.http.post(s+"/api/auth/signup",e)}resetPassword(e,t,r,n){let p=`${s}/api/auth/reset-password`,a={oldPassword:t,newPassword:r,confirmNewPassword:n};return this.http.post(p,a,{params:{token:e}}).pipe(w(()=>{console.log("Password reset successful")}),g(u=>(console.error("Error resetting password:",u),m(()=>new Error("Failed to reset password. Please try again.")))))}forgotPassword(e){let t=`${s}/api/auth/forgot-password`,r={email:e};return this.http.post(t,r)}resetPasswordNotLogin(e,t,r){let n=`${s}/api/auth/user/reset-password`,p={newPassword:t,confirmNewPassword:r};return this.http.post(n,p,{params:{token:e}})}static{this.\u0275fac=function(t){return new(t||o)(l(J),l(R),l(O))}}static{this.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{$ as a,J as b,ae as c,B as d,V as e};
